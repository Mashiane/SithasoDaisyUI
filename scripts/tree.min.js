gj.tree={plugins:{}},gj.tree.config={base:{params:{},autoLoad:!0,selectionType:"single",cascadeSelection:!1,dataSource:void 0,primaryKey:void 0,textField:"text",childrenField:"children",hasChildrenField:"hasChildren",imageCssClassField:"imageCssClass",imageUrlField:"imageUrl",imageHtmlField:"imageHtml",disabledField:"disabled",width:void 0,border:!1,uiLibrary:"materialdesign",iconsLibrary:"materialicons",autoGenId:1,autoGenFieldName:"autoId_b5497cc5-7ef3-49f5-a7dc-4a932e1aee4a",indentation:24,style:{wrapper:"gj-unselectable",list:"gj-list gj-list-md",item:void 0,active:"gj-list-md-active",leafIcon:void 0,border:"gj-tree-md-border"},icons:{expand:'<i class="gj-icon chevron-right" />',collapse:'<i class="gj-icon chevron-down" />'}},bootstrap:{style:{wrapper:"gj-unselectable gj-tree-bootstrap-3",list:"gj-list gj-list-bootstrap list-group",item:"list-group-item",active:"active",border:"gj-tree-bootstrap-border"},iconsLibrary:"glyphicons"},bootstrap4:{style:{wrapper:"gj-unselectable gj-tree-bootstrap-4",list:"gj-list gj-list-bootstrap",item:"list-group-item",active:"active",border:"gj-tree-bootstrap-border"},icons:{expand:'<i class="gj-icon plus" />',collapse:'<i class="gj-icon minus" />'}},bootstrap5:{style:{wrapper:"gj-unselectable gj-tree-bootstrap-5",list:"gj-list gj-list-bootstrap",item:"list-group-item",active:"active",border:"gj-tree-bootstrap-border"},icons:{expand:'<i class="gj-icon plus" />',collapse:'<i class="gj-icon minus" />'}},materialicons:{style:{expander:"gj-tree-material-icons-expander"}},fontawesome:{style:{expander:"gj-tree-font-awesome-expander"},icons:{expand:'<i class="fa fa-plus" aria-hidden="true"></i>',collapse:'<i class="fa fa-minus" aria-hidden="true"></i>'}},glyphicons:{style:{expander:"gj-tree-glyphicons-expander"},icons:{expand:'<span class="glyphicon glyphicon-plus" />',collapse:'<span class="glyphicon glyphicon-minus" />'}}},gj.tree.events={initialized:function($tree){$tree.triggerHandler("initialized")},dataBinding:function($tree){$tree.triggerHandler("dataBinding")},dataBound:function($tree){$tree.triggerHandler("dataBound")},select:function($tree,$node,id){return $tree.triggerHandler("select",[$node,id])},unselect:function($tree,$node,id){return $tree.triggerHandler("unselect",[$node,id])},expand:function($tree,$node,id){return $tree.triggerHandler("expand",[$node,id])},collapse:function($tree,$node,id){return $tree.triggerHandler("collapse",[$node,id])},enable:function($tree,$node){return $tree.triggerHandler("enable",[$node])},disable:function($tree,$node){return $tree.triggerHandler("disable",[$node])},destroying:function($tree){return $tree.triggerHandler("destroying")},nodeDataBound:function($tree,$node,id,record){return $tree.triggerHandler("nodeDataBound",[$node,id,record])}},gj.tree.methods={init:function(jsConfig){return gj.widget.prototype.init.call(this,jsConfig,"tree"),gj.tree.methods.initialize.call(this),this.data("autoLoad")&&this.reload(),this},initialize:function(){var data=this.data(),$root=$('<ul class="'+data.style.list+'"/>');this.empty().addClass(data.style.wrapper).append($root),data.width&&this.width(data.width),data.border&&this.addClass(data.style.border),gj.tree.events.initialized(this)},useHtmlDataSource:function($tree,data){data.dataSource=[]},render:function($tree,response){var data;return response&&("string"==typeof response&&JSON&&(response=JSON.parse(response)),(data=$tree.data()).records=response,data.primaryKey||gj.tree.methods.genAutoId(data,data.records),gj.tree.methods.loadData($tree)),$tree},filter:function($tree){return $tree.data().dataSource},genAutoId:function(data,records){var i;for(i=0;i<records.length;i++)records[i][data.autoGenFieldName]=data.autoGenId++,records[i][data.childrenField]&&records[i][data.childrenField].length&&gj.tree.methods.genAutoId(data,records[i][data.childrenField])},loadData:function($tree){var i,records=$tree.data("records"),$root=$tree.children("ul");for(gj.tree.events.dataBinding($tree),$root.off().empty(),i=0;i<records.length;i++)gj.tree.methods.appendNode($tree,$root,records[i],1);gj.tree.events.dataBound($tree)},appendNode:function($tree,$parent,nodeData,level,position){var i,$node,$newParent,$span,$img,data=$tree.data(),id=data.primaryKey?nodeData[data.primaryKey]:nodeData[data.autoGenFieldName];if($node=$('<li data-id="'+id+'" data-role="node" />').addClass(data.style.item),$wrapper=$('<div data-role="wrapper" />'),$expander=$('<span data-role="expander" data-mode="close"></span>').addClass(data.style.expander),$display=$('<span data-role="display">'+nodeData[data.textField]+"</span>"),hasChildren=void 0!==nodeData[data.hasChildrenField]&&"true"===nodeData[data.hasChildrenField].toString().toLowerCase(),disabled=void 0!==nodeData[data.disabledField]&&"true"===nodeData[data.disabledField].toString().toLowerCase(),data.indentation&&$wrapper.append('<span data-role="spacer" style="width: '+data.indentation*(level-1)+'px;"></span>'),disabled?gj.tree.methods.disableNode($tree,$node):($expander.on("click",gj.tree.methods.expanderClickHandler($tree)),$display.on("click",gj.tree.methods.displayClickHandler($tree))),$wrapper.append($expander),$wrapper.append($display),$node.append($wrapper),position?$parent.find("li:eq("+(position-1)+")").before($node):$parent.append($node),data.imageCssClassField&&nodeData[data.imageCssClassField]?($span=$('<span data-role="image"><span class="'+nodeData[data.imageCssClassField]+'"></span></span>')).insertBefore($display):data.imageUrlField&&nodeData[data.imageUrlField]?(($span=$('<span data-role="image"></span>')).insertBefore($display),($img=$('<img src="'+nodeData[data.imageUrlField]+'"></img>')).attr("width",$span.width()).attr("height",$span.height()),$span.append($img)):data.imageHtmlField&&nodeData[data.imageHtmlField]&&($span=$('<span data-role="image">'+nodeData[data.imageHtmlField]+"</span>")).insertBefore($display),nodeData[data.childrenField]&&nodeData[data.childrenField].length||hasChildren){if($expander.empty().append(data.icons.expand),$newParent=$("<ul />").addClass(data.style.list).addClass("gj-hidden"),$node.append($newParent),nodeData[data.childrenField]&&nodeData[data.childrenField].length)for(i=0;i<nodeData[data.childrenField].length;i++)gj.tree.methods.appendNode($tree,$newParent,nodeData[data.childrenField][i],level+1)}else data.style.leafIcon?$expander.addClass(data.style.leafIcon):$expander.html("&nbsp;");gj.tree.events.nodeDataBound($tree,$node,nodeData.id,nodeData)},expanderClickHandler:function($tree){return function(e){var $expander=$(this),$node=$expander.closest("li");"close"===$expander.attr("data-mode")?$tree.expand($node):$tree.collapse($node)}},expand:function($tree,$node,cascade){var $children,i,$expander=$node.find('>[data-role="wrapper"]>[data-role="expander"]'),data=$tree.data(),id=$node.attr("data-id"),$list=$node.children("ul");if(!1!==gj.tree.events.expand($tree,$node,id)&&$list&&$list.length&&($list.show(),$expander.attr("data-mode","open"),$expander.empty().append(data.icons.collapse),cascade))for($children=$node.find("ul>li"),i=0;i<$children.length;i++)gj.tree.methods.expand($tree,$($children[i]),cascade);return $tree},collapse:function($tree,$node,cascade){var $children,i,$expander=$node.find('>[data-role="wrapper"]>[data-role="expander"]'),data=$tree.data(),id=$node.attr("data-id"),$list=$node.children("ul");if(!1!==gj.tree.events.collapse($tree,$node,id)&&$list&&$list.length&&($list.hide(),$expander.attr("data-mode","close"),$expander.empty().append(data.icons.expand),cascade))for($children=$node.find("ul>li"),i=0;i<$children.length;i++)gj.tree.methods.collapse($tree,$($children[i]),cascade);return $tree},expandAll:function($tree){var i,$nodes=$tree.find("ul>li");for(i=0;i<$nodes.length;i++)gj.tree.methods.expand($tree,$($nodes[i]),!0);return $tree},collapseAll:function($tree){var i,$nodes=$tree.find("ul>li");for(i=0;i<$nodes.length;i++)gj.tree.methods.collapse($tree,$($nodes[i]),!0);return $tree},displayClickHandler:function($tree){return function(e){var $display,$node=$(this).closest("li"),cascade=$tree.data().cascadeSelection;"true"===$node.attr("data-selected")?gj.tree.methods.unselect($tree,$node,cascade):("single"===$tree.data("selectionType")&&gj.tree.methods.unselectAll($tree),gj.tree.methods.select($tree,$node,cascade))}},selectAll:function($tree){var i,$nodes=$tree.find("ul>li");for(i=0;i<$nodes.length;i++)gj.tree.methods.select($tree,$($nodes[i]),!0);return $tree},select:function($tree,$node,cascade){var i,$children,data=$tree.data();if("true"!==$node.attr("data-selected")&&!1!==gj.tree.events.select($tree,$node,$node.attr("data-id"))&&($node.addClass(data.style.active).attr("data-selected","true"),cascade))for($children=$node.find("ul>li"),i=0;i<$children.length;i++)gj.tree.methods.select($tree,$($children[i]),cascade)},unselectAll:function($tree){var i,$nodes=$tree.find("ul>li");for(i=0;i<$nodes.length;i++)gj.tree.methods.unselect($tree,$($nodes[i]),!0);return $tree},unselect:function($tree,$node,cascade){var i,$children,data=$tree.data();if("true"===$node.attr("data-selected")&&!1!==gj.tree.events.unselect($tree,$node,$node.attr("data-id"))&&($node.removeClass($tree.data().style.active).removeAttr("data-selected"),cascade))for($children=$node.find("ul>li"),i=0;i<$children.length;i++)gj.tree.methods.unselect($tree,$($children[i]),cascade)},getSelections:function($list){var i,$node,children,result=[],$nodes=$list.children("li");if($nodes&&$nodes.length)for(i=0;i<$nodes.length;i++)"true"===($node=$($nodes[i])).attr("data-selected")?result.push($node.attr("data-id")):$node.has("ul")&&(children=gj.tree.methods.getSelections($node.children("ul"))).length&&(result=result.concat(children));return result},getDataById:function($tree,id,records){var i,data=$tree.data(),result=void 0;for(i=0;i<records.length;i++){if(data.primaryKey&&records[i][data.primaryKey]==id){result=records[i];break}if(records[i][data.autoGenFieldName]==id){result=records[i];break}if(records[i][data.childrenField]&&records[i][data.childrenField].length&&(result=gj.tree.methods.getDataById($tree,id,records[i][data.childrenField])))break}return result},getDataByText:function($tree,text,records){var i,id,result=void 0,data=$tree.data();for(i=0;i<records.length;i++){if(text===records[i][data.textField]){result=records[i];break}if(records[i][data.childrenField]&&records[i][data.childrenField].length&&(result=gj.tree.methods.getDataByText($tree,text,records[i][data.childrenField])))break}return result},getNodeById:function($list,id){var i,$node,$result=void 0,$nodes=$list.children("li");if($nodes&&$nodes.length)for(i=0;i<$nodes.length;i++){if(id==($node=$($nodes[i])).attr("data-id")){$result=$node;break}if($node.has("ul")&&($result=gj.tree.methods.getNodeById($node.children("ul"),id)))break}return $result},getNodeByText:function($list,text){var i,$node,$result=void 0,$nodes=$list.children("li");if($nodes&&$nodes.length)for(i=0;i<$nodes.length;i++){if(text===($node=$($nodes[i])).find('>[data-role="wrapper"]>[data-role="display"]').text()){$result=$node;break}if($node.has("ul")&&($result=gj.tree.methods.getNodeByText($node.children("ul"),text)))break}return $result},addNode:function($tree,nodeData,$parent,position){var level,record,data=$tree.data();return $parent&&$parent.length?("li"===$parent[0].tagName.toLowerCase()&&(0===$parent.children("ul").length&&($parent.find('[data-role="expander"]').empty().append(data.icons.collapse),$parent.append($("<ul />").addClass(data.style.list))),$parent=$parent.children("ul")),(record=$tree.getDataById($parent.parent().data("id")))[data.childrenField]||(record[data.childrenField]=[]),record[data.childrenField].push(nodeData)):($parent=$tree.children("ul"),$tree.data("records").push(nodeData)),level=$parent.parentsUntil('[data-type="tree"]',"ul").length+1,data.primaryKey||gj.tree.methods.genAutoId(data,[nodeData]),gj.tree.methods.appendNode($tree,$parent,nodeData,level,position),$tree},remove:function($tree,$node){return gj.tree.methods.removeDataById($tree,$node.attr("data-id"),$tree.data("records")),$node.remove(),$tree},removeDataById:function($tree,id,records){var i,data=$tree.data();for(i=0;i<records.length;i++){if(data.primaryKey&&records[i][data.primaryKey]==id){records.splice(i,1);break}if(records[i][data.autoGenFieldName]==id){records.splice(i,1);break}records[i][data.childrenField]&&records[i][data.childrenField].length&&gj.tree.methods.removeDataById($tree,id,records[i][data.childrenField])}},update:function($tree,id,newRecord){var data=$tree.data(),$node=$tree.getNodeById(id),oldRecord=$tree.getDataById(id);return oldRecord=newRecord,$node.find('>[data-role="wrapper"]>[data-role="display"]').html(newRecord[data.textField]),gj.tree.events.nodeDataBound($tree,$node,id,newRecord),$tree},getChildren:function($tree,$node,cascade){var result=[],i,$children,cascade;for($children=(cascade=void 0===cascade||cascade)?$node.find("ul li"):$node.find(">ul>li"),i=0;i<$children.length;i++)result.push($($children[i]).data("id"));return result},enableAll:function($tree){var i,$children=$tree.find("ul>li");for(i=0;i<$children.length;i++)gj.tree.methods.enableNode($tree,$($children[i]),!0);return $tree},enableNode:function($tree,$node,cascade){var i,$children,$expander=$node.find('>[data-role="wrapper"]>[data-role="expander"]'),$display=$node.find('>[data-role="wrapper"]>[data-role="display"]'),cascade=void 0===cascade||cascade;if($node.removeClass("disabled"),$expander.on("click",gj.tree.methods.expanderClickHandler($tree)),$display.on("click",gj.tree.methods.displayClickHandler($tree)),gj.tree.events.enable($tree,$node),cascade)for($children=$node.find("ul>li"),i=0;i<$children.length;i++)gj.tree.methods.enableNode($tree,$($children[i]),cascade)},disableAll:function($tree){var i,$children=$tree.find("ul>li");for(i=0;i<$children.length;i++)gj.tree.methods.disableNode($tree,$($children[i]),!0);return $tree},disableNode:function($tree,$node,cascade){var i,$children,$expander=$node.find('>[data-role="wrapper"]>[data-role="expander"]'),$display=$node.find('>[data-role="wrapper"]>[data-role="display"]'),cascade=void 0===cascade||cascade;if($node.addClass("disabled"),$expander.off("click"),$display.off("click"),gj.tree.events.disable($tree,$node),cascade)for($children=$node.find("ul>li"),i=0;i<$children.length;i++)gj.tree.methods.disableNode($tree,$($children[i]),cascade)},destroy:function($tree){var data;return $tree.data()&&(gj.tree.events.destroying($tree),$tree.xhr&&$tree.xhr.abort(),$tree.off(),$tree.removeData(),$tree.removeAttr("data-type"),$tree.removeClass().empty()),$tree},pathFinder:function(data,list,id,parents){var i,result=!1;for(i=0;i<list.length;i++){if(list[i].id==id){result=!0;break}if(gj.tree.methods.pathFinder(data,list[i][data.childrenField],id,parents)){parents.push(list[i].data[data.textField]),result=!0;break}}return result}},gj.tree.widget=function($element,jsConfig){var self=this,methods=gj.tree.methods;return this.reload=function(params){return gj.widget.prototype.reload.call(this,params)},this.render=function(response){return methods.render(this,response)},this.addNode=function(data,$parentNode,position){return methods.addNode(this,data,$parentNode,position)},this.removeNode=function($node){return methods.remove(this,$node)},this.updateNode=function(id,record){return methods.update(this,id,record)},this.destroy=function(){return methods.destroy(this)},this.expand=function($node,cascade){return methods.expand(this,$node,cascade)},this.collapse=function($node,cascade){return methods.collapse(this,$node,cascade)},this.expandAll=function(){return methods.expandAll(this)},this.collapseAll=function(){return methods.collapseAll(this)},this.getDataById=function(id){return methods.getDataById(this,id,this.data("records"))},this.getDataByText=function(text){return methods.getDataByText(this,text,this.data("records"))},this.getNodeById=function(id){return methods.getNodeById(this.children("ul"),id)},this.getNodeByText=function(text){return methods.getNodeByText(this.children("ul"),text)},this.getAll=function(){return this.data("records")},this.select=function($node){return methods.select(this,$node)},this.unselect=function($node){return methods.unselect(this,$node)},this.selectAll=function(){return methods.selectAll(this)},this.unselectAll=function(){return methods.unselectAll(this)},this.getSelections=function(){return methods.getSelections(this.children("ul"))},this.getChildren=function($node,cascade){return methods.getChildren(this,$node,cascade)},this.parents=function(id){var parents=[],data=this.data();return methods.pathFinder(data,data.records,id,parents),parents.reverse()},this.enable=function($node,cascade){return methods.enableNode(this,$node,cascade)},this.enableAll=function(){return methods.enableAll(this)},this.disable=function($node,cascade){return methods.disableNode(this,$node,cascade)},this.disableAll=function(){return methods.disableAll(this)},$.extend($element,this),"tree"!==$element.attr("data-type")&&methods.init.call($element,jsConfig),$element},gj.tree.widget.prototype=new gj.widget,gj.tree.widget.constructor=gj.tree.widget,function($){$.fn.tree=function(method){var $widget;if(this&&this.length){if("object"!=typeof method&&method){if(($widget=new gj.tree.widget(this,null))[method])return $widget[method].apply(this,Array.prototype.slice.call(arguments,1));throw"Method "+method+" does not exist."}return new gj.tree.widget(this,method)}}}(jQuery),gj.tree.plugins.checkboxes={config:{base:{checkboxes:void 0,checkedField:"checked",cascadeCheck:!0}},private:{dataBound:function($tree){var $nodes;$tree.data("cascadeCheck")&&($nodes=$tree.find('li[data-role="node"]'),$.each($nodes,(function(){var $node=$(this),state=$node.find('[data-role="checkbox"] input[type="checkbox"]').checkbox("state");"checked"===state&&(gj.tree.plugins.checkboxes.private.updateChildrenState($node,state),gj.tree.plugins.checkboxes.private.updateParentState($node,state))})))},nodeDataBound:function($tree,$node,id,record){var data,$expander,$checkbox,$wrapper,disabled;0===$node.find('> [data-role="wrapper"] > [data-role="checkbox"]').length&&(data=$tree.data(),$expander=$node.find('> [data-role="wrapper"] > [data-role="expander"]'),$checkbox=$('<input type="checkbox"/>'),$wrapper=$('<span data-role="checkbox"></span>').append($checkbox),disabled=void 0!==record[data.disabledField]&&"true"===record[data.disabledField].toString().toLowerCase(),$checkbox=$checkbox.checkbox({uiLibrary:data.uiLibrary,iconsLibrary:data.iconsLibrary,change:function(e,state){gj.tree.plugins.checkboxes.events.checkboxChange($tree,$node,record,$checkbox.state())}}),disabled&&$checkbox.prop("disabled",!0),record[data.checkedField]&&$checkbox.state("checked"),$checkbox.on("click",(function(e){var $node=$checkbox.closest("li"),state=$checkbox.state();data.cascadeCheck&&(gj.tree.plugins.checkboxes.private.updateChildrenState($node,state),gj.tree.plugins.checkboxes.private.updateParentState($node,state))})),$expander.after($wrapper))},updateParentState:function($node,state){var $parentNode,$parentCheckbox,$siblingCheckboxes,allChecked,allUnchecked,parentState;1===($parentNode=$node.parent("ul").parent("li")).length&&($parentCheckbox=$node.parent("ul").parent("li").find('> [data-role="wrapper"] > [data-role="checkbox"] input[type="checkbox"]'),$siblingCheckboxes=$node.siblings().find('> [data-role="wrapper"] > span[data-role="checkbox"] input[type="checkbox"]'),allChecked="checked"===state,allUnchecked="unchecked"===state,parentState="indeterminate",$.each($siblingCheckboxes,(function(){var state=$(this).checkbox("state");allChecked&&"checked"!==state&&(allChecked=!1),allUnchecked&&"unchecked"!==state&&(allUnchecked=!1)})),allChecked&&!allUnchecked&&(parentState="checked"),!allChecked&&allUnchecked&&(parentState="unchecked"),$parentCheckbox.checkbox("state",parentState),gj.tree.plugins.checkboxes.private.updateParentState($parentNode,$parentCheckbox.checkbox("state")))},updateChildrenState:function($node,state){var $childrenCheckboxes=$node.find('ul li [data-role="wrapper"] [data-role="checkbox"] input[type="checkbox"]');$childrenCheckboxes.length>0&&$.each($childrenCheckboxes,(function(){$(this).checkbox("state",state)}))},update:function($tree,$node,state){var checkbox=$node.find('[data-role="checkbox"] input[type="checkbox"]').first();$(checkbox).checkbox("state",state),$tree.data().cascadeCheck&&(gj.tree.plugins.checkboxes.private.updateChildrenState($node,state),gj.tree.plugins.checkboxes.private.updateParentState($node,state))}},public:{getCheckedNodes:function(){var result=[],checkboxes=this.find('li [data-role="checkbox"] input[type="checkbox"]');return $.each(checkboxes,(function(){var checkbox=$(this);"checked"===checkbox.checkbox("state")&&result.push(checkbox.closest("li").data("id"))})),result},checkAll:function(){var $checkboxes=this.find('li [data-role="checkbox"] input[type="checkbox"]');return $.each($checkboxes,(function(){$(this).checkbox("state","checked")})),this},uncheckAll:function(){var $checkboxes=this.find('li [data-role="checkbox"] input[type="checkbox"]');return $.each($checkboxes,(function(){$(this).checkbox("state","unchecked")})),this},check:function($node){return gj.tree.plugins.checkboxes.private.update(this,$node,"checked"),this},uncheck:function($node){return gj.tree.plugins.checkboxes.private.update(this,$node,"unchecked"),this}},events:{checkboxChange:function($tree,$node,record,state){return $tree.triggerHandler("checkboxChange",[$node,record,state])}},configure:function($tree){$tree.data("checkboxes")&&gj.checkbox&&($.extend(!0,$tree,gj.tree.plugins.checkboxes.public),$tree.on("nodeDataBound",(function(e,$node,id,record){gj.tree.plugins.checkboxes.private.nodeDataBound($tree,$node,id,record)})),$tree.on("dataBound",(function(){gj.tree.plugins.checkboxes.private.dataBound($tree)})),$tree.on("enable",(function(e,$node){$node.find('>[data-role="wrapper"]>[data-role="checkbox"] input[type="checkbox"]').prop("disabled",!1)})),$tree.on("disable",(function(e,$node){$node.find('>[data-role="wrapper"]>[data-role="checkbox"] input[type="checkbox"]').prop("disabled",!0)})))}},gj.tree.plugins.dragAndDrop={config:{base:{dragAndDrop:void 0,style:{dragEl:"gj-tree-drag-el gj-tree-md-drag-el",dropAsChildIcon:"gj-cursor-pointer gj-icon plus",dropAbove:"gj-tree-drop-above",dropBelow:"gj-tree-drop-below"}},bootstrap:{style:{dragEl:"gj-tree-drag-el gj-tree-bootstrap-drag-el",dropAsChildIcon:"glyphicon glyphicon-plus",dropAbove:"drop-above",dropBelow:"drop-below"}},bootstrap4:{style:{dragEl:"gj-tree-drag-el gj-tree-bootstrap-drag-el",dropAsChildIcon:"gj-cursor-pointer gj-icon plus",dropAbove:"drop-above",dropBelow:"drop-below"}}},private:{nodeDataBound:function($tree,$node){var $wrapper=$node.children('[data-role="wrapper"]'),$display=$node.find('>[data-role="wrapper"]>[data-role="display"]');$wrapper.length&&$display.length&&($display.on("mousedown",gj.tree.plugins.dragAndDrop.private.createNodeMouseDownHandler($tree)),$display.on("mousemove",gj.tree.plugins.dragAndDrop.private.createNodeMouseMoveHandler($tree,$node,$display)),$display.on("mouseup",gj.tree.plugins.dragAndDrop.private.createNodeMouseUpHandler($tree)))},createNodeMouseDownHandler:function($tree){return function(e){$tree.data("dragReady",!0)}},createNodeMouseUpHandler:function($tree){return function(e){$tree.data("dragReady",!1)}},createNodeMouseMoveHandler:function($tree,$node,$display){return function(e){if($tree.data("dragReady")){var data=$tree.data(),$dragEl,$wrapper,offsetTop,offsetLeft;$tree.data("dragReady",!1),$dragEl=$display.clone().wrap('<div data-role="wrapper"/>').closest("div").wrap('<li class="'+data.style.item+'" />').closest("li").wrap('<ul class="'+data.style.list+'" />').closest("ul"),$("body").append($dragEl),$dragEl.attr("data-role","draggable-clone").addClass("gj-unselectable").addClass(data.style.dragEl),$dragEl.find('[data-role="wrapper"]').prepend('<span data-role="indicator" />'),$dragEl.draggable({drag:gj.tree.plugins.dragAndDrop.private.createDragHandler($tree,$node,$display),stop:gj.tree.plugins.dragAndDrop.private.createDragStopHandler($tree,$node,$display)}),$wrapper=$display.parent(),offsetTop=$display.offset().top,offsetTop-=parseInt($wrapper.css("border-top-width"))+parseInt($wrapper.css("margin-top"))+parseInt($wrapper.css("padding-top")),offsetLeft=$display.offset().left,offsetLeft-=parseInt($wrapper.css("border-left-width"))+parseInt($wrapper.css("margin-left"))+parseInt($wrapper.css("padding-left")),offsetLeft-=$dragEl.find('[data-role="indicator"]').outerWidth(!0),$dragEl.css({position:"absolute",top:offsetTop,left:offsetLeft,width:$display.outerWidth(!0)}),"true"===$display.attr("data-droppable")&&$display.droppable("destroy"),gj.tree.plugins.dragAndDrop.private.getTargetDisplays($tree,$node,$display).each((function(){var $dropEl=$(this);"true"===$dropEl.attr("data-droppable")&&$dropEl.droppable("destroy"),$dropEl.droppable()})),gj.tree.plugins.dragAndDrop.private.getTargetDisplays($tree,$node).each((function(){var $dropEl=$(this);"true"===$dropEl.attr("data-droppable")&&$dropEl.droppable("destroy"),$dropEl.droppable()})),$dragEl.trigger("mousedown")}}},getTargetDisplays:function($tree,$node,$display){return $tree.find('[data-role="display"]').not($display).not($node.find('[data-role="display"]'))},getTargetWrappers:function($tree,$node){return $tree.find('[data-role="wrapper"]').not($node.find('[data-role="wrapper"]'))},createDragHandler:function($tree,$node,$display){var $displays=gj.tree.plugins.dragAndDrop.private.getTargetDisplays($tree,$node,$display),$wrappers=gj.tree.plugins.dragAndDrop.private.getTargetWrappers($tree,$node),data=$tree.data();return function(e,offset,mousePosition){var $dragEl=$(this),success=!1;$displays.each((function(){var $targetDisplay,$indicator;if($(this).droppable("isOver",mousePosition))return $indicator=$dragEl.find('[data-role="indicator"]'),data.style.dropAsChildIcon?$indicator.addClass(data.style.dropAsChildIcon):$indicator.text("+"),success=!0,!1;$dragEl.find('[data-role="indicator"]').removeClass(data.style.dropAsChildIcon).empty()})),$wrappers.each((function(){var $wrapper=$(this),$indicator,middle;!success&&$wrapper.droppable("isOver",mousePosition)?(middle=$wrapper.position().top+$wrapper.outerHeight()/2,mousePosition.y<middle?$wrapper.addClass(data.style.dropAbove).removeClass(data.style.dropBelow):$wrapper.addClass(data.style.dropBelow).removeClass(data.style.dropAbove)):$wrapper.removeClass(data.style.dropAbove).removeClass(data.style.dropBelow)}))}},createDragStopHandler:function($tree,$sourceNode,$sourceDisplay){var $displays=gj.tree.plugins.dragAndDrop.private.getTargetDisplays($tree,$sourceNode,$sourceDisplay),$wrappers=gj.tree.plugins.dragAndDrop.private.getTargetWrappers($tree,$sourceNode),data=$tree.data();return function(e,mousePosition){var success=!1,record,$targetNode,$sourceParentNode,parent;$(this).draggable("destroy").remove(),$displays.each((function(){var $targetDisplay=$(this),$ul;if($targetDisplay.droppable("isOver",mousePosition))return $targetNode=$targetDisplay.closest("li"),$sourceParentNode=$sourceNode.parent("ul").parent("li"),0===($ul=$targetNode.children("ul")).length&&($ul=$("<ul />").addClass(data.style.list),$targetNode.append($ul)),!1!==gj.tree.plugins.dragAndDrop.events.nodeDrop($tree,$sourceNode.data("id"),$targetNode.data("id"),$ul.children("li").length+1)&&($ul.append($sourceNode),record=$tree.getDataById($sourceNode.data("id")),gj.tree.methods.removeDataById($tree,$sourceNode.data("id"),data.records),void 0===(parent=$tree.getDataById($ul.parent().data("id")))[data.childrenField]&&(parent[data.childrenField]=[]),parent[data.childrenField].push(record),gj.tree.plugins.dragAndDrop.private.refresh($tree,$sourceNode,$targetNode,$sourceParentNode)),success=!0,!1;$targetDisplay.droppable("destroy")})),success||$wrappers.each((function(){var $targetWrapper=$(this),prepend,orderNumber,sourceNodeId;if($targetWrapper.droppable("isOver",mousePosition))return $targetNode=$targetWrapper.closest("li"),$sourceParentNode=$sourceNode.parent("ul").parent("li"),prepend=mousePosition.y<$targetWrapper.position().top+$targetWrapper.outerHeight()/2,sourceNodeId=$sourceNode.data("id"),orderNumber=$targetNode.prevAll('li:not([data-id="'+sourceNodeId+'"])').length+(prepend?1:2),!1!==gj.tree.plugins.dragAndDrop.events.nodeDrop($tree,sourceNodeId,$targetNode.parent("ul").parent("li").data("id"),orderNumber)&&(record=$tree.getDataById($sourceNode.data("id")),gj.tree.methods.removeDataById($tree,$sourceNode.data("id"),data.records),$tree.getDataById($targetNode.parent().data("id"))[data.childrenField].splice($targetNode.index()+(prepend?0:1),0,record),prepend?$sourceNode.insertBefore($targetNode):$sourceNode.insertAfter($targetNode),gj.tree.plugins.dragAndDrop.private.refresh($tree,$sourceNode,$targetNode,$sourceParentNode)),!1;$targetWrapper.droppable("destroy")}))}},refresh:function($tree,$sourceNode,$targetNode,$sourceParentNode){var data=$tree.data();gj.tree.plugins.dragAndDrop.private.refreshNode($tree,$targetNode),gj.tree.plugins.dragAndDrop.private.refreshNode($tree,$sourceParentNode),gj.tree.plugins.dragAndDrop.private.refreshNode($tree,$sourceNode),$sourceNode.find('li[data-role="node"]').each((function(){gj.tree.plugins.dragAndDrop.private.refreshNode($tree,$(this))})),$targetNode.children('[data-role="wrapper"]').removeClass(data.style.dropAbove).removeClass(data.style.dropBelow)},refreshNode:function($tree,$node){var $wrapper=$node.children('[data-role="wrapper"]'),$expander=$wrapper.children('[data-role="expander"]'),$spacer=$wrapper.children('[data-role="spacer"]'),$list=$node.children("ul"),data=$tree.data(),level=$node.parentsUntil('[data-type="tree"]',"ul").length;$list.length&&$list.children().length?$list.is(":visible")?$expander.empty().append(data.icons.collapse):$expander.empty().append(data.icons.expand):$expander.empty(),$wrapper.removeClass(data.style.dropAbove).removeClass(data.style.dropBelow),$spacer.css("width",data.indentation*(level-1))}},public:{},events:{nodeDrop:function($tree,id,parentId,orderNumber){return $tree.triggerHandler("nodeDrop",[id,parentId,orderNumber])}},configure:function($tree){$.extend(!0,$tree,gj.tree.plugins.dragAndDrop.public),$tree.data("dragAndDrop")&&gj.draggable&&gj.droppable&&$tree.on("nodeDataBound",(function(e,$node){gj.tree.plugins.dragAndDrop.private.nodeDataBound($tree,$node)}))}},gj.tree.plugins.lazyLoading={config:{base:{paramNames:{parentId:"parentId"},lazyLoading:!1}},private:{nodeDataBound:function($tree,$node,id,record){var data=$tree.data(),$expander=$node.find('> [data-role="wrapper"] > [data-role="expander"]');record.hasChildren&&$expander.empty().append(data.icons.expand)},createDoneHandler:function($tree,$node){return function(response){var i,$expander,$list,data=$tree.data();if("string"==typeof response&&JSON&&(response=JSON.parse(response)),response&&response.length){for(0===($list=$node.children("ul")).length&&($list=$("<ul />").addClass(data.style.list),$node.append($list)),i=0;i<response.length;i++)$tree.addNode(response[i],$list);($expander=$node.find('>[data-role="wrapper"]>[data-role="expander"]')).attr("data-mode","open"),$expander.empty().append(data.icons.collapse),gj.tree.events.dataBound($tree)}}},expand:function($tree,$node,id){var ajaxOptions,data=$tree.data(),params={},$children=$node.find(">ul>li");$children&&$children.length||"string"==typeof data.dataSource&&(params[data.paramNames.parentId]=id,ajaxOptions={url:data.dataSource,data:params},$tree.xhr&&$tree.xhr.abort(),$tree.xhr=$.ajax(ajaxOptions).done(gj.tree.plugins.lazyLoading.private.createDoneHandler($tree,$node)).fail($tree.createErrorHandler()))}},public:{},events:{},configure:function($tree,fullConfig,clientConfig){clientConfig.lazyLoading&&($tree.on("nodeDataBound",(function(e,$node,id,record){gj.tree.plugins.lazyLoading.private.nodeDataBound($tree,$node,id,record)})),$tree.on("expand",(function(e,$node,id){gj.tree.plugins.lazyLoading.private.expand($tree,$node,id)})))}};